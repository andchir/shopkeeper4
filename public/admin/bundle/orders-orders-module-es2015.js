(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"4p3S":function(t,e,i){"use strict";i.d(e,"a",(function(){return m}));var n=i("XNiG"),o=i("1G5W"),r=i("RwQR"),s=i("Y2tp"),c=i("8Y7J"),a=i("7AsP"),l=i("G0yt"),d=i("TSSN");const b=["table"];let m=(()=>{class t{constructor(t,e,i,o){this.dataService=t,this.activeModal=e,this.modalService=i,this.translateService=o,this.items=[],this.loading=!1,this.selectedIds=[],this.collectionSize=0,this.queryOptions=new r.a("name","asc",1,10,0,0),this.destroyed$=new n.a}ngOnInit(){this.getList(),this.afterInit()}afterInit(){}onSearchClear(){this.getList()}onModalClose(t){}onSearchWordUpdate(t){if(void 0!==t)return this.queryOptions.search_word=t,this.queryOptions.page=1,void(this.queryOptions.search_word?this.getList():this.onSearchClear());clearTimeout(this.searchTimer),this.searchTimer=setTimeout(()=>{this.queryOptions.page=1,this.getList()},700)}getModalElementId(t){return["modal",t||0].join("-")}setModalInputs(t,e=!1,i=""){const n=void 0!==t&&!e;this.modalRef.componentInstance.modalTitle=this.getLangString(n?"EDITING":"ADD"),this.modalRef.componentInstance.modalId=i,this.modalRef.componentInstance.itemId=t||0,this.modalRef.componentInstance.isItemCopy=e||!1,this.modalRef.componentInstance.isEditMode=n}modalOpen(t,e=!1){const i=this.getModalElementId(t);if(window.document.body.classList.add("modal-open"),window.document.getElementById(i)){const t=window.document.getElementById(i),e=t.previousElementSibling;return t.classList.add("d-block"),t.classList.remove("modal-minimized"),void e.classList.remove("d-none")}this.modalRef=this.modalService.open(this.getModalContent(),{size:"lg",backdrop:"static",keyboard:!1,backdropClass:"modal-backdrop-left45",windowClass:"modal-left45",container:"#modals-container"}),this.setModalInputs(t,e,i),this.modalRef.result.then(t=>{this.destroyed$.isStopped||(this.onModalClose(t),this.getList())},t=>{this.destroyed$.isStopped||(this.onModalClose(t),t&&["submit","updated"].indexOf(t)>-1&&this.getList())})}deleteItemConfirm(t){this.modalRef=this.modalService.open(s.b),this.modalRef.componentInstance.modalTitle=this.getLangString("CONFIRM"),this.modalRef.componentInstance.modalContent=this.getLangString("YOU_SURE_YOU_WANT_DELETE"),this.modalRef.result.then(e=>{"accept"===e&&this.deleteItem(t)})}getLangString(t){return this.translateService.store.translations[this.translateService.currentLang]&&this.translateService.store.translations[this.translateService.currentLang][t]||t}confirmAction(t){return this.modalRef=this.modalService.open(s.b),this.modalRef.componentInstance.modalTitle=this.getLangString("CONFIRM"),this.modalRef.componentInstance.modalContent=t,this.modalRef.result}blockSelected(){0!==this.selectedIds.length?this.dataService.actionBatch(this.selectedIds,"block").subscribe(t=>{this.clearSelected(),this.getList()},t=>this.showAlert(t.error||this.getLangString("ERROR"))):this.showAlert(this.getLangString("NOTHING_IS_SELECTED"))}deleteSelected(){0!==this.selectedIds.length?this.confirmAction(this.getLangString("YOU_SURE_YOU_WANT_DELETE_SELECTED")).then(t=>{"accept"===t&&this.dataService.actionBatch(this.selectedIds,"delete").subscribe(t=>{this.clearSelected(),this.getList()},t=>this.showAlert(t.error||this.getLangString("ERROR")))}):this.showAlert(this.getLangString("NOTHING_IS_SELECTED"))}showAlert(t){this.modalRef=this.modalService.open(s.a),this.modalRef.componentInstance.modalContent=t,this.modalRef.componentInstance.modalTitle=this.getLangString("ERROR"),this.modalRef.componentInstance.messageType="error"}deleteItem(t){this.confirmAction(this.getLangString("YOU_SURE_YOU_WANT_DELETE")).then(e=>{"accept"===e&&this.dataService.deleteItem(t).subscribe(t=>{this.getList()},t=>{t.error&&this.showAlert(t.error)})})}clearSelected(){this.table&&this.table.clearSelected()}actionRequest(t){switch(t[0]){case"edit":this.modalOpen(t[1]);break;case"copy":this.modalOpen(t[1],!0);break;case"delete":this.deleteItem(t[1]);break;case"changeQuery":this.getList()}}getList(){this.loading=!0,this.dataService.getListPage(this.queryOptions).pipe(Object(o.a)(this.destroyed$)).subscribe({next:t=>{this.items=t.items,this.collectionSize=t.total,this.loading=!1},error:t=>{this.items=[],this.collectionSize=0,t.error&&this.showAlert(t.error),this.loading=!1}})}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}}return t.title="",t.\u0275fac=function(e){return new(e||t)(c.Qb(a.a),c.Qb(l.b),c.Qb(l.h),c.Qb(d.d))},t.\u0275dir=c.Lb({type:t,viewQuery:function(t,e){var i;1&t&&c.Jc(b,!0),2&t&&c.Cc(i=c.jc())&&(e.table=i.first)}}),t})()},"8Eda":function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));class n{constructor(t,e,i,n,o){this.changed=t,this.loading=e,this.values=i,this.defaultOptions=n,this.defaultValues=o}}},b1TM:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var n=i("IheW"),o=i("LRne"),r=i("JIr8"),s=(i("8Eda"),i("8Y7J"));let c=(()=>{class t{constructor(t){this.http=t,this.headers=new n.e({"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"}),this.requestUrl="",this.requestUrl="/admin/settings"}setRequestUrl(t){this.requestUrl=t}getRequestUrl(){return this.requestUrl}getList(){return this.http.get(this.getRequestUrl()).pipe(Object(r.a)(this.handleError()))}clearSystemCache(){const t=this.getRequestUrl()+"/clear_system_cache";return this.http.post(t,{},{headers:this.headers}).pipe(Object(r.a)(this.handleError()))}runActionPost(t){const e=this.getRequestUrl()+"/"+t;return this.http.post(e,{},{headers:this.headers}).pipe(Object(r.a)(this.handleError()))}updateGroup(t,e){const i=this.getRequestUrl()+"/"+t;return this.http.put(i,e,{headers:this.headers}).pipe(Object(r.a)(this.handleError()))}getComposerPackagesList(){return this.http.get(this.getRequestUrl()+"_composer_installed_packages").pipe(Object(r.a)(this.handleError()))}composerRequirePackage(t,e){const i=this.getRequestUrl()+"_composer_require_package";return this.http.post(i,{packageName:t,packageVersion:e},{headers:this.headers}).pipe(Object(r.a)(this.handleError()))}handleError(t="operation",e){return t=>{if(t.error)throw t.error;return Object(o.a)(e)}}}return t.\u0275fac=function(e){return new(e||t)(s.ec(n.a))},t.\u0275prov=s.Mb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},h9W5:function(t,e,i){"use strict";i.r(e);var n=i("SVse"),o=i("d2mR"),r=i("iInd"),s=i("s7LF"),c=i("LvDl"),a=i("wgQU");class l{constructor(t,e,i,n,o,r,s,c,a,l,d,b){this.id=t,this.title=e,this.count=i,this.price=n,this.uniqId=o,this.priceTotal=r,this.contentTypeName=s,this.uri=c,this.image=a,this.parameters=l,this.files=d,this.currency=b,this.createParametersString(),this.createFilesString()}get parametersString(){return this._parametersString}set parametersString(t){this._parametersString=t}get filesString(){return this._filesString}set filesString(t){this._filesString=t}priceUpdate(){this.priceTotal=this.price*this.count;let t=0;void 0!==this.parameters&&this.parameters.forEach(e=>{t+=e.price*this.count}),this.priceTotal+=t}createParametersString(){if(!this.parameters)return;const t=[];this.parameters.forEach(e=>{let i="";e.name&&(i+=e.name+": "),i+=e.value+(e.price?` (${e.price})`:""),t.push(i)}),this.parametersString=t.join(", ")}createFilesString(){if(!this.files)return;const t=[],e=a.a.getBaseUrl();this.files.forEach(i=>{let n=`<a href="${e}admin/files/download/${i.fileId}" target="_blank">`;n+=`${i.title}.${i.extension}</a>`,t.push(n)}),this.filesString=t.join(", ")}}class d{constructor(t,e,i,n,o,r,s,c,a,l,d,b,m,h,u,p,g){this.id=t,this.userId=e,this.status=i,this.email=n,this.phone=o,this.fullName=r,this.createdDate=s,this.deliveryName=c,this.deliveryPrice=a,this.paymentName=l,this.paymentValue=d,this.comment=b,this.contentCount=m,this.price=h,this.currency=u,this.options=p,this.currencyRate=g}get content(){return this._content}set content(t){this._content=[],t.forEach(t=>{this._content.push(new l(t.id,t.title,t.count,t.price,t.uniqId,t.priceTotal,t.contentTypeName,t.uri,t.image,t.parameters,t.files||[]))})}}var b=i("4p3S"),m=i("7AsP"),h=i("8Y7J"),u=i("IheW");let p=(()=>{class t extends m.a{constructor(t){super(t),this.setRequestUrl("/admin/orders")}}return t.\u0275fac=function(e){return new(e||t)(h.ec(u.a))},t.\u0275prov=h.Mb({token:t,factory:t.\u0275fac}),t})();var g=i("ot8b"),f=i("b1TM"),v=(i("8Eda"),i("RwQR")),E=i("G0yt"),y=i("TSSN"),V=i("hecf");function D(t,e){if(1&t&&(h.Wb(0,"div",44),h.Oc(1),h.Vb()),2&t){const t=h.kc();h.Db(1),h.Qc(" ",t.formErrors.email," ")}}function I(t,e){if(1&t&&(h.Wb(0,"div",44),h.Oc(1),h.Vb()),2&t){const t=h.kc();h.Db(1),h.Qc(" ",t.formErrors.fullName," ")}}function S(t,e){if(1&t&&(h.Wb(0,"div",44),h.Oc(1),h.Vb()),2&t){const t=h.kc();h.Db(1),h.Qc(" ",t.formErrors.phone," ")}}function W(t,e){if(1&t&&(h.Wb(0,"option",46),h.Oc(1),h.Vb()),2&t){const t=e.$implicit;h.rc("value",t.name),h.Db(1),h.Pc(t.name)}}function O(t,e){if(1&t&&(h.Ub(0),h.Mc(1,W,2,2,"option",45),h.Tb()),2&t){const t=h.kc();h.Db(1),h.rc("ngForOf",t.settings.SETTINGS_DELIVERY)}}function R(t,e){if(1&t&&(h.Wb(0,"option",46),h.Oc(1),h.Vb()),2&t){const t=e.$implicit;h.rc("value",t.name),h.Db(1),h.Pc(t.name)}}function C(t,e){if(1&t&&(h.Ub(0),h.Mc(1,R,2,2,"option",45),h.Tb()),2&t){const t=h.kc();h.Db(1),h.rc("ngForOf",t.settings.SETTINGS_PAYMENT)}}const M=function(t){return{"is-invalid":t}};function T(t,e){if(1&t){const t=h.Xb();h.Wb(0,"tr",62),h.Wb(1,"td"),h.Rb(2,"input",63),h.Vb(),h.Wb(3,"td"),h.Rb(4,"input",64),h.Vb(),h.Wb(5,"td",65),h.Rb(6,"input",66),h.Vb(),h.Wb(7,"td",65),h.Wb(8,"button",67),h.ic("click",(function(i){h.Ec(t);const n=e.index;return h.kc(4).arrayFieldDelete("options",n,i)})),h.lc(9,"translate"),h.Rb(10,"i",11),h.Vb(),h.Vb(),h.Vb()}if(2&t){const t=e.$implicit;h.rc("formGroupName",e.index+""),h.Db(2),h.rc("ngClass",h.wc(7,M,t.controls.name.touched&&!t.controls.name.valid)),h.Db(2),h.rc("ngClass",h.wc(9,M,t.controls.title.touched&&!t.controls.title.valid)),h.Db(2),h.rc("ngClass",h.wc(11,M,t.controls.value.touched&&!t.controls.value.valid)),h.Db(2),h.sc("ngbTooltip",h.mc(9,5,"DELETE"))}}function w(t,e){if(1&t&&(h.Wb(0,"tbody"),h.Mc(1,T,11,13,"tr",61),h.Vb()),2&t){const t=h.kc(3);h.Db(1),h.rc("ngForOf",t.arrayFields.options.controls)}}function k(t,e){if(1&t){const t=h.Xb();h.Wb(0,"div",52),h.Wb(1,"table",53),h.Wb(2,"colgroup"),h.Rb(3,"col",54),h.Rb(4,"col",54),h.Rb(5,"col",55),h.Rb(6,"col",56),h.Vb(),h.Wb(7,"thead"),h.Wb(8,"tr"),h.Wb(9,"th"),h.Oc(10),h.lc(11,"translate"),h.Vb(),h.Wb(12,"th"),h.Oc(13),h.lc(14,"translate"),h.Vb(),h.Wb(15,"th"),h.Oc(16),h.lc(17,"translate"),h.Vb(),h.Rb(18,"th"),h.Vb(),h.Vb(),h.Mc(19,w,2,1,"tbody",34),h.Wb(20,"tfoot"),h.Wb(21,"tr",57),h.Wb(22,"td",58),h.Wb(23,"button",59),h.ic("click",(function(e){return h.Ec(t),h.kc(2).arrayFieldAdd("options",e)})),h.Rb(24,"i",60),h.Oc(25," \xa0 "),h.Wb(26,"span"),h.Oc(27),h.lc(28,"translate"),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb()}if(2&t){const t=h.kc(2);h.Db(10),h.Pc(h.mc(11,5,"SYSTEM_NAME")),h.Db(3),h.Pc(h.mc(14,7,"NAME")),h.Db(3),h.Pc(h.mc(17,9,"VALUE")),h.Db(3),h.rc("ngIf",t.arrayFields.options),h.Db(8),h.Pc(h.mc(28,11,"ADD"))}}function N(t,e){if(1&t&&(h.Ub(0),h.Oc(1),h.Tb()),2&t){const t=h.kc(2).$implicit;h.Db(1),h.Qc(" ",t.title," ")}}function L(t,e){if(1&t&&(h.Wb(0,"a",87),h.Oc(1),h.Vb()),2&t){const t=h.kc(2).$implicit,e=h.kc(3);h.uc("href","",e.baseUrl,"",t.uri,"",h.Gc),h.Db(1),h.Qc(" ",t.title," ")}}function F(t,e){if(1&t&&(h.Wb(0,"div"),h.Rb(1,"i",88),h.Oc(2,"\xa0 "),h.Rb(3,"span",89),h.Vb()),2&t){const t=h.kc(2).$implicit;h.Db(3),h.rc("innerHTML",t.filesString,h.Fc)}}function A(t,e){if(1&t){const t=h.Xb();h.Ub(0),h.Wb(1,"tr",78),h.Wb(2,"td"),h.Oc(3),h.Vb(),h.Wb(4,"td"),h.Mc(5,N,2,1,"ng-container",79),h.Mc(6,L,2,3,"ng-template",null,80,h.Nc),h.Wb(8,"div",81),h.Oc(9),h.Mc(10,F,4,1,"div",34),h.Vb(),h.Vb(),h.Wb(11,"td",82),h.Oc(12),h.lc(13,"number"),h.Vb(),h.Wb(14,"td",65),h.Oc(15),h.Vb(),h.Wb(16,"td",82),h.Wb(17,"div",83),h.Wb(18,"div",84),h.Wb(19,"button",85),h.ic("click",(function(){h.Ec(t);const e=h.kc().$implicit;return h.kc(3).editContentToggle(e)})),h.lc(20,"translate"),h.Rb(21,"i",86),h.Vb(),h.Wb(22,"button",85),h.ic("click",(function(){h.Ec(t);const e=h.kc().$implicit;return h.kc(3).deleteContent(e)})),h.lc(23,"translate"),h.Rb(24,"i",11),h.Vb(),h.Vb(),h.Vb(),h.Oc(25),h.lc(26,"number"),h.Vb(),h.Vb(),h.Tb()}if(2&t){const t=h.Dc(7),e=h.kc().$implicit;h.Db(3),h.Pc(e.id),h.Db(2),h.rc("ngIf",!e.uri)("ngIfElse",t),h.Db(4),h.Qc(" ",e.parametersString," "),h.Db(1),h.rc("ngIf",e.filesString),h.Db(2),h.Qc(" ",h.oc(13,10,e.price,"1.2-2","ru-RU")," "),h.Db(3),h.Qc(" ",e.count," "),h.Db(4),h.sc("ngbTooltip",h.mc(20,14,"EDIT")),h.Db(3),h.sc("ngbTooltip",h.mc(23,16,"DELETE")),h.Db(3),h.Qc(" ",h.oc(26,18,e.priceTotal,"1.2-2","ru-RU")," ")}}const _=function(){return{standalone:!0}};function P(t,e){if(1&t){const t=h.Xb();h.Ub(0),h.Wb(1,"tr",90),h.Wb(2,"td"),h.Oc(3),h.Vb(),h.Wb(4,"td"),h.Oc(5),h.Vb(),h.Wb(6,"td",82),h.Wb(7,"input",91),h.ic("ngModelChange",(function(e){return h.Ec(t),h.kc().$implicit.price=e}))("ngModelChange",(function(){return h.Ec(t),h.kc(4).priceTotalUpdate()})),h.Vb(),h.Vb(),h.Wb(8,"td",92),h.Wb(9,"input",93),h.ic("ngModelChange",(function(e){return h.Ec(t),h.kc().$implicit.count=e}))("ngModelChange",(function(){return h.Ec(t),h.kc(4).priceTotalUpdate()})),h.Vb(),h.Wb(10,"button",85),h.ic("click",(function(){h.Ec(t);const e=h.kc().$implicit;return h.kc(3).editContentToggle(e)})),h.lc(11,"translate"),h.Rb(12,"i",94),h.Vb(),h.Wb(13,"button",85),h.ic("click",(function(){return h.Ec(t),h.kc(4).editContentCancel()})),h.lc(14,"translate"),h.Rb(15,"i",95),h.Vb(),h.Vb(),h.Vb(),h.Tb()}if(2&t){const t=h.kc().$implicit;h.Db(3),h.Pc(t.id),h.Db(2),h.Qc(" ",t.title," "),h.Db(2),h.rc("ngModel",t.price)("ngModelOptions",h.vc(12,_)),h.Db(2),h.rc("ngModel",t.count)("ngModelOptions",h.vc(13,_)),h.Db(1),h.sc("ngbTooltip",h.mc(11,8,"ACCEPT")),h.Db(3),h.sc("ngbTooltip",h.mc(14,10,"CANCEL"))}}function q(t,e){if(1&t&&(h.Ub(0),h.Mc(1,A,27,22,"ng-container",34),h.Mc(2,P,16,14,"ng-container",34),h.Tb()),2&t){const t=e.$implicit,i=h.kc(3);h.Db(1),h.rc("ngIf",!i.getIsContentEdit(t)),h.Db(1),h.rc("ngIf",i.getIsContentEdit(t))}}function U(t,e){if(1&t&&(h.Wb(0,"table",53),h.Wb(1,"colgroup"),h.Rb(2,"col",68),h.Rb(3,"col",69),h.Rb(4,"col",70),h.Rb(5,"col",71),h.Rb(6,"col",72),h.Vb(),h.Wb(7,"thead"),h.Wb(8,"tr"),h.Wb(9,"th"),h.Oc(10,"ID"),h.Vb(),h.Wb(11,"th"),h.Oc(12),h.lc(13,"translate"),h.Vb(),h.Wb(14,"th",65),h.Oc(15),h.lc(16,"translate"),h.Vb(),h.Wb(17,"th",65),h.Oc(18),h.lc(19,"translate"),h.Vb(),h.Wb(20,"th",65),h.Oc(21),h.lc(22,"translate"),h.Vb(),h.Vb(),h.Vb(),h.Wb(23,"tbody"),h.Mc(24,q,3,2,"ng-container",73),h.Wb(25,"tr"),h.Rb(26,"td"),h.Wb(27,"td"),h.Oc(28),h.lc(29,"translate"),h.Vb(),h.Wb(30,"td",65),h.Oc(31),h.lc(32,"number"),h.Vb(),h.Rb(33,"td",74),h.Vb(),h.Vb(),h.Wb(34,"tfoot"),h.Wb(35,"tr"),h.Wb(36,"td",75),h.Oc(37),h.lc(38,"translate"),h.Vb(),h.Wb(39,"td",76),h.Wb(40,"b"),h.Oc(41),h.lc(42,"number"),h.Vb(),h.Oc(43," \xa0 "),h.Wb(44,"span",77),h.Oc(45),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Vb()),2&t){const t=h.kc(2);h.Db(12),h.Pc(h.mc(13,10,"NAME")),h.Db(3),h.Pc(h.mc(16,12,"PRICE")),h.Db(3),h.Pc(h.mc(19,14,"QUANTITY")),h.Db(3),h.Pc(h.mc(22,16,"PRICE_TOTAL")),h.Db(3),h.rc("ngForOf",t.model.content),h.Db(4),h.Pc(h.mc(29,18,"DELIVERY")),h.Db(3),h.Qc(" ",h.oc(32,20,t.model.deliveryPrice,"1.2-2","ru-RU")," "),h.Db(6),h.Qc(" ",h.mc(38,24,"PRICE_TOTAL"),": "),h.Db(4),h.Pc(h.oc(42,26,t.model.price,"1.2-2","ru-RU")),h.Db(4),h.Pc(t.model.currency)}}function Q(t,e){if(1&t){const t=h.Xb();h.Wb(0,"div",96),h.Wb(1,"button",97),h.ic("click",(function(){return h.Ec(t),h.kc(2).errorMessage=""})),h.Wb(2,"span",98),h.Oc(3,"\xd7"),h.Vb(),h.Vb(),h.Oc(4),h.Vb()}if(2&t){const t=h.kc(2);h.Db(4),h.Qc(" ",t.errorMessage," ")}}function x(t,e){if(1&t&&(h.Wb(0,"div"),h.Wb(1,"ngb-accordion",47),h.Wb(2,"ngb-panel",48),h.lc(3,"translate"),h.Mc(4,k,29,13,"ng-template",49),h.Vb(),h.Wb(5,"ngb-panel",50),h.lc(6,"translate"),h.Mc(7,U,46,30,"ng-template",49),h.Vb(),h.Vb(),h.Mc(8,Q,5,1,"div",51),h.Vb()),2&t){const t=h.kc();h.Db(1),h.rc("closeOthers",!0),h.Db(1),h.rc("title",h.mc(3,4,"OPTIONS")),h.Db(3),h.rc("title",h.mc(6,6,"ORDER_CONTENT")),h.Db(3),h.rc("ngIf",t.errorMessage)}}const j=function(t){return{"no-events":t}},$=function(t){return{"form-control-search-clear":t}};let G=(()=>{class t extends g.a{constructor(t,e,i,n,o,r,c){super(t,e,i,n,o),this.fb=t,this.activeModal=e,this.translateService=i,this.dataService=n,this.elRef=o,this.settingsService=r,this.appSettings=c,this.model=new d(0,0,"","",""),this.modalTitle="Order",this.formFields=[{name:"id",validators:[s.w.required]},{name:"email",validators:[s.w.required,this.emailValidator]},{name:"phone",validators:[]},{name:"fullName",validators:[s.w.required]},{name:"comment",validators:[]},{name:"deliveryName",validators:[]},{name:"paymentName",validators:[]},{name:"options",validators:[],children:[{name:"name",validators:[s.w.required]},{name:"title",validators:[s.w.required]},{name:"value",validators:[]}]},{name:"content",validators:[],children:[{name:"uniqId",validators:[]},{name:"id",validators:[]},{name:"price",validators:[]},{name:"count",validators:[]}]}],this.contentEdit=new l(0,"",0,0)}onBeforeInit(){this.baseUrl=this.appSettings.settings.webApiUrl+"/",this.settings=this.appSettings.settings.systemSettings}editContentToggle(t){if(this.getIsContentEdit(t)){const t=Object(c.findIndex)(this.model.content,{uniqId:this.contentEdit.uniqId,contentTypeName:this.contentEdit.contentTypeName});t>-1&&this.arrayFields.content.at(t).patchValue({price:this.model.content[t].price,count:this.model.content[t].count}),this.contentEdit=new l(0,"",0,0),this.priceTotalUpdate()}else this.contentEdit=Object(c.cloneDeep)(t)}editContentCancel(){if(!this.contentEdit.uniqId)return;const t=Object(c.findIndex)(this.model.content,{uniqId:this.contentEdit.uniqId,contentTypeName:this.contentEdit.contentTypeName});t>-1&&(this.model.content[t]=Object(c.cloneDeep)(this.contentEdit),this.contentEdit=new l(0,"",0,0,""),this.priceTotalUpdate())}getIsContentEdit(t){return this.contentEdit.uniqId===t.uniqId&&this.contentEdit.contentTypeName===t.contentTypeName}deleteContent(t){const e=Object(c.findIndex)(this.model.content,{uniqId:t.uniqId,contentTypeName:t.contentTypeName});e>-1&&(this.model.content.splice(e,1),this.arrayFields.content.removeAt(e),this.priceTotalUpdate())}onDeliveryUpdate(){if(!this.settings||!this.settings.SETTINGS_DELIVERY)return;const t=Object(c.findIndex)(this.settings.SETTINGS_DELIVERY,{name:this.model.deliveryName});if(t>-1){const e=parseFloat(String(this.settings.SETTINGS_DELIVERY[t].options.price));this.model.deliveryPrice=e/(this.model.currencyRate||1),this.priceTotalUpdate()}}priceTotalUpdate(){let t=parseFloat(String(this.model.deliveryPrice));this.model.content.forEach(e=>{e instanceof l&&e.priceUpdate(),t+=e.priceTotal}),this.model.price=t}}return t.\u0275fac=function(e){return new(e||t)(h.Qb(s.e),h.Qb(E.b),h.Qb(y.d),h.Qb(p),h.Qb(h.l),h.Qb(f.a),h.Qb(a.a))},t.\u0275cmp=h.Kb({type:t,selectors:[["app-modal-order"]],features:[h.Cb([]),h.Ab],decls:103,vars:89,consts:[[1,"position-relative","modal-on-maximized"],[1,"tabs-top"],["type","button",1,"btn","btn-outline-primary","btn-sm","d-block",3,"disabled","click"],[1,"icon-cross","mr-1"],[1,"icon-minimize","mr-1"],[1,"modal-header","d-block"],[1,"position-relative","modal-on-minimized"],[1,"pos-absolute-right"],["type","button",1,"btn","btn-no-border","btn-sm-sm",3,"title","click"],[1,"icon-maximize"],["type","button",1,"btn","btn-no-border","btn-sm-sm","ml-1",3,"title","click"],[1,"icon-cross"],[1,"modal-title","text-overflow","mr-5"],["method","post",3,"formGroup","ngClass","ngSubmit"],["formEl",""],[1,"modal-body","py-0"],[1,"card","bg-light","mb-3"],[1,"card-body","p-2"],[1,"float-right"],["target","_blank",1,"btn","btn-info","btn-sm","btn-wide",3,"href"],[1,"icon-printer"],[1,"d-inline-block","p-1"],[1,"clearfix"],[1,"row"],[1,"col-lg-6"],[1,"form-group","form-group-message"],[1,"label-filled"],["type","text","name","id","formControlName","id","readonly","",1,"form-control",3,"ngModel","ngModelChange"],["type","text","name","title","formControlName","email",1,"form-control",3,"ngModel","ngModelChange"],["class","alert alert-danger",4,"ngIf"],["type","text","name","title","formControlName","fullName",1,"form-control",3,"ngModel","ngModelChange"],["type","text","name","phone","formControlName","phone",1,"form-control",3,"ngModel","ngModelChange"],["name","comment","formControlName","comment","rows","5",1,"form-control",3,"ngModel","ngModelChange"],["name","deliveryName","formControlName","deliveryName",1,"custom-select",3,"ngModel","ngModelChange"],[4,"ngIf"],["name","paymentName","formControlName","paymentName",1,"custom-select",3,"ngModel","ngModelChange"],[1,"modal-footer","d-block"],[1,"btn-group","mr-1"],["type","button",1,"btn","btn-success","btn-wide",3,"disabled","click"],["ngbDropdown","","role","group","placement","top-right",1,"btn-group"],["type","button","ngbDropdownToggle","",1,"btn","btn-success","dropdown-toggle-split",3,"disabled"],["ngbDropdownMenu","",1,"dropdown-menu"],["type","button","ngbDropdownItem","",3,"click"],["type","button",1,"btn","btn-secondary","btn-wide",3,"click"],[1,"alert","alert-danger"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["activeIds","accordion-order-content",1,"ngb-accordion",3,"closeOthers"],["id","accordion-order-options",3,"title"],["ngbPanelContent",""],["id","accordion-order-content",3,"title"],["class","alert alert-danger mt-3 mb-0",4,"ngIf"],["formArrayName","options"],[1,"table","table-bordered","mb-0"],["width","27%"],["width","39%"],["width","7%"],[1,"bg-faded"],["colspan","4",1,"text-center"],["type","button",1,"btn","btn-secondary","btn-sm",3,"click"],[1,"icon-plus"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["type","text","formControlName","name",1,"form-control","form-control-sm",3,"ngClass"],["type","text","formControlName","title",1,"form-control","form-control-sm",3,"ngClass"],[1,"text-center"],["type","text","formControlName","value",1,"form-control","form-control-sm",3,"ngClass"],["type","button",1,"btn","btn-secondary","btn-sm",3,"ngbTooltip","click"],["width","10%"],["width","30%"],["width","20%"],["width","15%"],["width","25%"],[4,"ngFor","ngForOf"],["colspan","2"],["colspan","4",1,"text-right"],[1,"text-center","big"],[1,"small"],[1,"show-on-hover-parent"],[4,"ngIf","ngIfElse"],["productLink",""],[1,"text-muted","small"],[1,"text-center","pr-2"],[1,"relative"],[1,"show-on-hover-right","no-wrap"],["type","button",1,"btn","btn-secondary","btn-sm","ml-2",3,"ngbTooltip","click"],[1,"icon-pencil"],["target","_blank",3,"href"],[1,"icon-file"],[3,"innerHTML"],[1,"table-warning"],["type","number","name","price[]","min","0","step","0.01",1,"d-inline-block","form-control","form-control-sm",2,"width","100px",3,"ngModel","ngModelOptions","ngModelChange"],["colspan","2",1,"no-wrap"],["type","number","name","count[]","min","1","step","1",1,"d-inline-block","form-control","form-control-sm",2,"width","60px",3,"ngModel","ngModelOptions","ngModelChange"],[1,"icon-check"],[1,"icon-ban"],[1,"alert","alert-danger","mt-3","mb-0"],["type","button",1,"close",3,"click"],["aria-hidden","true"]],template:function(t,e){1&t&&(h.Wb(0,"div",0),h.Wb(1,"div",1),h.Wb(2,"button",2),h.ic("click",(function(t){return e.closeModal(t)})),h.Rb(3,"i",3),h.Wb(4,"span"),h.Oc(5),h.lc(6,"translate"),h.Vb(),h.Vb(),h.Wb(7,"button",2),h.ic("click",(function(t){return e.minimize(t)})),h.Rb(8,"i",4),h.Wb(9,"span"),h.Oc(10),h.lc(11,"translate"),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Wb(12,"div",5),h.Wb(13,"div",6),h.Wb(14,"div",7),h.Wb(15,"button",8),h.ic("click",(function(t){return e.maximize(t)})),h.lc(16,"translate"),h.Rb(17,"i",9),h.Vb(),h.Wb(18,"button",10),h.ic("click",(function(t){return e.closeModal(t)})),h.lc(19,"translate"),h.Rb(20,"i",11),h.Vb(),h.Vb(),h.Vb(),h.Wb(21,"h4",12),h.Oc(22),h.Vb(),h.Vb(),h.Wb(23,"form",13,14),h.ic("ngSubmit",(function(){return e.onSubmit()})),h.Wb(25,"div",15),h.Wb(26,"div",16),h.Wb(27,"div",17),h.Wb(28,"div",18),h.Wb(29,"a",19),h.Rb(30,"i",20),h.Oc(31),h.lc(32,"translate"),h.Vb(),h.Vb(),h.Wb(33,"div",21),h.Oc(34),h.lc(35,"date"),h.Vb(),h.Rb(36,"div",22),h.Vb(),h.Vb(),h.Wb(37,"div",23),h.Wb(38,"div",24),h.Wb(39,"div",25),h.Wb(40,"label",26),h.Oc(41),h.lc(42,"translate"),h.Vb(),h.Wb(43,"input",27),h.ic("ngModelChange",(function(t){return e.model.id=t})),h.Vb(),h.Vb(),h.Vb(),h.Wb(44,"div",24),h.Wb(45,"div",25),h.Wb(46,"label",26),h.Oc(47),h.lc(48,"translate"),h.Vb(),h.Wb(49,"input",28),h.ic("ngModelChange",(function(t){return e.model.email=t})),h.Vb(),h.Mc(50,D,2,1,"div",29),h.Vb(),h.Vb(),h.Vb(),h.Wb(51,"div",23),h.Wb(52,"div",24),h.Wb(53,"div",25),h.Wb(54,"label",26),h.Oc(55),h.lc(56,"translate"),h.Vb(),h.Wb(57,"input",30),h.ic("ngModelChange",(function(t){return e.model.fullName=t})),h.Vb(),h.Mc(58,I,2,1,"div",29),h.Vb(),h.Wb(59,"div",25),h.Wb(60,"label",26),h.Oc(61),h.lc(62,"translate"),h.Vb(),h.Wb(63,"input",31),h.ic("ngModelChange",(function(t){return e.model.phone=t})),h.Vb(),h.Mc(64,S,2,1,"div",29),h.Vb(),h.Vb(),h.Wb(65,"div",24),h.Wb(66,"div",25),h.Wb(67,"label",26),h.Oc(68),h.lc(69,"translate"),h.Vb(),h.Wb(70,"textarea",32),h.ic("ngModelChange",(function(t){return e.model.comment=t})),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Wb(71,"div",23),h.Wb(72,"div",24),h.Wb(73,"div",25),h.Wb(74,"label",26),h.Oc(75),h.lc(76,"translate"),h.Vb(),h.Wb(77,"select",33),h.ic("ngModelChange",(function(t){return e.model.deliveryName=t}))("ngModelChange",(function(){return e.onDeliveryUpdate()})),h.Mc(78,O,2,1,"ng-container",34),h.Vb(),h.Vb(),h.Vb(),h.Wb(79,"div",24),h.Wb(80,"div",25),h.Wb(81,"label",26),h.Oc(82),h.lc(83,"translate"),h.Vb(),h.Wb(84,"select",35),h.ic("ngModelChange",(function(t){return e.model.paymentName=t})),h.Mc(85,C,2,1,"ng-container",34),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Mc(86,x,9,8,"div",34),h.Vb(),h.Wb(87,"div",36),h.Wb(88,"div",37),h.Wb(89,"button",38),h.ic("click",(function(t){return e.save(!0,t)})),h.Wb(90,"span"),h.Oc(91),h.lc(92,"translate"),h.Vb(),h.Vb(),h.Wb(93,"div",39),h.Rb(94,"button",40),h.Wb(95,"div",41),h.Wb(96,"button",42),h.ic("click",(function(t){return e.save(!1,t)})),h.Oc(97),h.lc(98,"translate"),h.Vb(),h.Vb(),h.Vb(),h.Vb(),h.Wb(99,"button",43),h.ic("click",(function(t){return e.closeModal(t)})),h.Wb(100,"span"),h.Oc(101),h.lc(102,"translate"),h.Vb(),h.Vb(),h.Vb(),h.Vb()),2&t&&(h.Db(2),h.rc("disabled",e.submitted),h.Db(3),h.Pc(h.mc(6,54,"CLOSE")),h.Db(2),h.rc("disabled",e.submitted),h.Db(3),h.Pc(h.mc(11,56,"MINIMIZE")),h.Db(5),h.rc("title",h.mc(16,58,"EXPAND")),h.Db(3),h.rc("title",h.mc(19,60,"CLOSE")),h.Db(4),h.Pc(e.modalTitle),h.Db(1),h.rc("formGroup",e.form)("ngClass",h.wc(87,j,e.submitted)),h.Db(2),h.Ib("loading",e.loading),h.Db(4),h.uc("href","",e.baseUrl,"admin/orders/print/",e.model.id,"",h.Gc),h.Db(2),h.Qc(" ",h.mc(32,62,"PRINT")," "),h.Db(3),h.Qc(" ",h.nc(35,64,e.model.createdDate,"dd/MM/y H:mm:s")," "),h.Db(7),h.Qc(" ",h.mc(42,67,"ID")," "),h.Db(2),h.Ib("is-invalid",e.formErrors.id),h.rc("ngModel",e.model.id),h.Db(4),h.Qc(" ",h.mc(48,69,"EMAIL")," "),h.Db(2),h.Ib("is-invalid",e.formErrors.email),h.rc("ngModel",e.model.email),h.Db(1),h.rc("ngIf",e.formErrors.email),h.Db(5),h.Qc(" ",h.mc(56,71,"FULL_NAME")," "),h.Db(2),h.Ib("is-invalid",e.formErrors.fullName),h.rc("ngModel",e.model.fullName),h.Db(1),h.rc("ngIf",e.formErrors.fullName),h.Db(3),h.Qc(" ",h.mc(62,73,"PHONE")," "),h.Db(2),h.Ib("is-invalid",e.formErrors.phone),h.rc("ngModel",e.model.phone),h.Db(1),h.rc("ngIf",e.formErrors.phone),h.Db(4),h.Qc(" ",h.mc(69,75,"COMMENT")," "),h.Db(2),h.Ib("is-invalid",e.formErrors.comment),h.rc("ngModel",e.model.comment),h.Db(5),h.Qc(" ",h.mc(76,77,"DELIVERY_METHOD")," "),h.Db(2),h.Ib("is-invalid",e.formErrors.deliveryName),h.rc("ngModel",e.model.deliveryName),h.Db(1),h.rc("ngIf",e.settings),h.Db(4),h.Qc(" ",h.mc(83,79,"PAYMENT_METHOD")," "),h.Db(2),h.Ib("is-invalid",e.formErrors.paymentName),h.rc("ngModel",e.model.paymentName),h.Db(1),h.rc("ngIf",e.settings),h.Db(1),h.rc("ngIf",e.model.content),h.Db(3),h.rc("disabled",e.submitted),h.Db(2),h.Pc(h.mc(92,81,"SAVE_AND_CLOSE")),h.Db(3),h.rc("disabled",e.submitted),h.Db(3),h.Pc(h.mc(98,83,"SAVE")),h.Db(4),h.Pc(h.mc(102,85,"CLOSE")))},directives:[s.y,s.o,s.h,n.n,s.b,s.n,s.g,n.p,s.v,E.d,E.g,E.f,E.e,n.o,s.r,s.x,E.a,E.k,E.l,s.d,s.i,E.u,s.s,s.q],pipes:[y.c,n.e,n.f],encapsulation:2}),t})();const Y=[{path:"",component:(()=>{class t extends b.a{constructor(t,e,i,n){super(t,e,i,n),this.dataService=t,this.activeModal=e,this.modalService=i,this.translateService=n,this.queryOptions=new v.a("createdDate","desc",1,10,0,0),this.items=[],this.tableFields=[{name:"id",sortName:"id",title:"ID",outputType:"text",outputProperties:{}},{name:"status",sortName:"status",title:"STATUS",outputType:"status",outputProperties:{}},{name:"price",sortName:"price",title:"PRICE",outputType:"number",outputProperties:{}},{name:"contentCount",sortName:"contentCount",title:"CONTENT_COUNT",outputType:"text",outputProperties:{}},{name:"email",sortName:"email",title:"EMAIL",outputType:"userEmail",outputProperties:{}},{name:"createdDate",sortName:"createdDate",title:"DATE_TIME",outputType:"date",outputProperties:{format:"dd/MM/y H:mm:s"}}]}setModalInputs(t,e=!1,i=""){this.modalRef.componentInstance.modalTitle=`${this.getLangString("ORDER")} #${t}`,this.modalRef.componentInstance.modalId=i,this.modalRef.componentInstance.itemId=t||0,this.modalRef.componentInstance.isItemCopy=e||!1,this.modalRef.componentInstance.isEditMode=!0}getModalElementId(t){return["modal","order",t||0].join("-")}getModalContent(){return G}changeRequest(t){const[e,i,n]=t;e.id&&this.dataService.updateProperty(e.id,i,n).subscribe(()=>{this.getList()})}}return t.title="ORDERS",t.\u0275fac=function(e){return new(e||t)(h.Qb(p),h.Qb(E.b),h.Qb(E.h),h.Qb(y.d))},t.\u0275cmp=h.Kb({type:t,selectors:[["app-shk-orders"]],features:[h.Cb([p]),h.Ab],decls:31,vars:26,consts:[[1,"card"],[1,"card-body"],[1,"icon-bag"],[1,"mb-3"],[1,"float-md-left"],[1,"form-control-search","mb-2","mb-md-0",3,"ngClass"],["type","text",1,"form-control","min-width250",3,"placeholder","ngModel","ngModelChange"],[3,"click"],[1,"float-md-right"],["ngbDropdown","","placement","bottom-right",1,"d-block","d-md-inline-block","mb-2","mb-md-0"],["ngbDropdownToggle","",1,"btn","btn-info","d-block","d-md-inline-block","width-100","width-md-auto"],["ngbDropdownMenu",""],[1,"dropdown-item",3,"click"],["type","button",1,"btn","btn-secondary","d-block","d-md-inline-block","width-100","width-md-auto","ml-md-2",3,"ngbTooltip","click"],[1,"icon-reload"],[1,"float-left"],[1,"clearfix"],[1,"min-height400"],[3,"items","selectedIds","collectionSize","queryOptions","tableFields","loading","isCloneAllowed","selectedIdsChange","loadingChange","actionRequest","changeRequest"],["table",""]],template:function(t,e){1&t&&(h.Wb(0,"div",0),h.Wb(1,"div",1),h.Wb(2,"h3"),h.Rb(3,"i",2),h.Oc(4),h.lc(5,"translate"),h.Vb(),h.Rb(6,"hr"),h.Wb(7,"div",3),h.Wb(8,"div",4),h.Wb(9,"div",5),h.Wb(10,"input",6),h.ic("ngModelChange",(function(t){return e.queryOptions.search_word=t}))("ngModelChange",(function(){return e.onSearchWordUpdate()})),h.lc(11,"translate"),h.Vb(),h.Wb(12,"span",7),h.ic("click",(function(){return e.onSearchWordUpdate("")})),h.Vb(),h.Vb(),h.Vb(),h.Wb(13,"div",8),h.Wb(14,"div",9),h.Wb(15,"button",10),h.Wb(16,"span"),h.Oc(17),h.lc(18,"translate"),h.Vb(),h.Vb(),h.Wb(19,"div",11),h.Wb(20,"button",12),h.ic("click",(function(){return e.deleteSelected()})),h.Oc(21),h.lc(22,"translate"),h.Vb(),h.Vb(),h.Vb(),h.Wb(23,"button",13),h.ic("click",(function(){return e.getList()})),h.lc(24,"translate"),h.Rb(25,"i",14),h.Vb(),h.Vb(),h.Rb(26,"div",15),h.Rb(27,"div",16),h.Vb(),h.Wb(28,"div",17),h.Wb(29,"app-table",18,19),h.ic("selectedIdsChange",(function(t){return e.selectedIds=t}))("loadingChange",(function(t){return e.loading=t}))("actionRequest",(function(t){return e.actionRequest(t)}))("changeRequest",(function(t){return e.changeRequest(t)})),h.Vb(),h.Vb(),h.Vb(),h.Vb()),2&t&&(h.Db(4),h.Qc(" ",h.mc(5,14,"ORDERS")," "),h.Db(5),h.rc("ngClass",h.wc(24,$,!!e.queryOptions.search_word)),h.Db(1),h.tc("placeholder","",h.mc(11,16,"SEARCH"),"..."),h.rc("ngModel",e.queryOptions.search_word),h.Db(7),h.Pc(h.mc(18,18,"BATCH_ACTIONS")),h.Db(4),h.Pc(h.mc(22,20,"DELETE")),h.Db(2),h.sc("ngbTooltip",h.mc(24,22,"REFRESH")),h.Db(6),h.rc("items",e.items)("selectedIds",e.selectedIds)("collectionSize",e.collectionSize)("queryOptions",e.queryOptions)("tableFields",e.tableFields)("loading",e.loading)("isCloneAllowed",!1))},directives:[n.n,s.b,s.n,s.q,E.d,E.g,E.f,E.u,V.a],pipes:[y.c],encapsulation:2}),t})()}];let z=(()=>{class t{}return t.\u0275mod=h.Ob({type:t}),t.\u0275inj=h.Nb({factory:function(e){return new(e||t)},imports:[[r.f.forChild(Y)],r.f]}),t})();i.d(e,"OrdersModule",(function(){return B}));let B=(()=>{class t{}return t.\u0275mod=h.Ob({type:t}),t.\u0275inj=h.Nb({factory:function(e){return new(e||t)},providers:[p],imports:[[n.c,o.a,z]]}),t})()},ot8b:function(t,e,i){"use strict";i.d(e,"a",(function(){return b}));var n=i("s7LF"),o=i("XNiG"),r=i("1G5W"),s=i("7AsP"),c=i("8Y7J"),a=i("G0yt"),l=i("TSSN");const d=["formEl"];let b=(()=>{class t{constructor(t,e,i,n,r){this.fb=t,this.activeModal=e,this.translateService=i,this.dataService=n,this.elRef=r,this.modalId="",this._formFieldsErrors={},this.submitted=!1,this.loading=!1,this.closeReason="canceled",this.files={},this.formFields=[],this.arrayFields={},this.isSaveButtonDisabled=!1,this.localeDefault="",this.localeCurrent="",this.localeFieldsAllowed=[],this.localePreviousValues={},this.uniqueId="",this.destroyed$=new o.a}set formErrors(t){for(const e in t)if(t.hasOwnProperty(e)){const t=this.getControl(this.form,null,e);t&&t.setErrors({incorrect:!0})}this._formFieldsErrors=t}get formErrors(){return this._formFieldsErrors}ngOnInit(){this.uniqueId=this.createUniqueId(),this.elRef&&this.getRootElement().setAttribute("id",this.modalId),this.onBeforeInit(),this.buildForm(),this.isEditMode||this.isItemCopy?this.getModelData().then(()=>{this.onAfterGetData()}):this.onAfterGetData(),this.onAfterInit()}onBeforeInit(){}onAfterInit(){}onAfterGetData(){this.buildControls(this.form,this.formFields)}getSystemFieldName(){return""}getLangString(t){return this.translateService.store.translations[this.translateService.currentLang][t]||t}getModelData(){return this.loading=!0,new Promise((t,e)=>{this.dataService.getItem(this.itemId).pipe(Object(r.a)(this.destroyed$)).subscribe({next:e=>{if(this.isItemCopy){e.id=null;const t=this.getSystemFieldName();t&&(e[t]="")}Object.assign(this.model,e),this.loading=!1,t(e)},error:t=>{this.errorMessage=t.error||this.getLangString("ERROR"),this.loading=!1,e(t)}})})}buildForm(){this.form=this.fb.group(this.buildControls(null,this.formFields)),this.form.valueChanges.pipe(Object(r.a)(this.destroyed$)).subscribe(()=>this.onValueChanged())}buildControls(t,e,i="model"){const n={};return void 0===t&&(t=this.form||null),e.forEach(e=>{const o=this.getControl(t,e);let r=null;if(i&&this[i]?(this[i].options||(this[i].options={}),r=0===e.name.indexOf("options_")?this[i].options[e.name.substr(8)]||null:this[i][e.name]||null):r=null,o)if(e.disabled&&o.disable(),e.children){const t=r,i=o;i.clear(),t.forEach((t,n)=>{const o=this.getFormFieldByName(e.name),r=this.buildControls(null,o.children,null);i.push(this.fb.group(r))}),i.patchValue(t)}else o.setValue(r);else e.children?(n[e.name]=this.fb.array([]),this.createArrayFieldsProperty(e.name)):n[e.name]=this.fb.control({value:r,disabled:e.disabled||!1},e.validators)}),n}onValueChanged(t="form"){this[t]&&(this[t].valid&&(this.errorMessage=""),Object.keys(this[t].value).forEach(t=>{this.formErrors[t]="";const e=this.getControl(this.form,null,t);if(e&&!e.valid&&e.errors){let i="";Object.keys(e.errors).forEach(t=>{i+=(i?" ":"")+this.getLangString("INVALID_"+t.toUpperCase())}),this.formErrors[t]=i}}))}getFormFieldByName(t){const e=this.formFields.filter(e=>e.name===t);return e.length>0?e[0]:null}createArrayFieldsProperty(t){Object.defineProperty(this.arrayFields,t,{get:()=>this.form?this.form.get(t):null})}getControl(t,e,i){return t?t.get(i||e.name):null}focusFormError(){setTimeout(()=>{this.formEl.nativeElement.querySelector(".form-control.is-invalid")&&this.formEl.nativeElement.querySelector(".form-control.is-invalid").focus()},1)}formGroupMarkTouched(t){Object.keys(t.controls).forEach(e=>{t.controls[e].markAsTouched(),t.controls[e]instanceof n.c&&Array.from(this.form.controls[e].controls).forEach(t=>{this.formGroupMarkTouched(t)})})}getSaveRequest(t){return t.id||"root"===t.name?this.dataService.update(t):this.dataService.create(t)}getFormData(){const t=this.form.value;return t.id=this.model.id||0,void 0!==this.model.translations&&(t.translations=this.model.translations||null),t}arrayFieldDelete(t,e,i){i&&i.preventDefault(),this.arrayFields[t].removeAt(e)}arrayFieldAdd(t,e){e&&e.preventDefault();const i=this.getFormFieldByName(t);if(!i)return;const n=this.buildControls(null,i.children,null);this.arrayFields[t].push(this.fb.group(n))}closeModal(t){t&&t.preventDefault(),this.close(this.closeReason)}close(t,e){e&&e.preventDefault(),"submit"===t?this.activeModal.close(t):this.activeModal.dismiss(t)}minimize(t){t&&t.preventDefault(),window.document.body.classList.remove("modal-open");const e=this.getRootElement(),i=e.previousElementSibling;e.classList.remove("d-block"),e.classList.add("modal-minimized"),i.classList.add("d-none")}maximize(t){t&&t.preventDefault(),window.document.body.classList.add("modal-open");const e=this.getRootElement(),i=e.previousElementSibling;e.classList.add("d-block"),e.classList.remove("modal-minimized"),i.classList.remove("d-none")}save(t=!1,e){e&&e.preventDefault(),this.onSubmit(t)}saveFiles(t){if(0===Object.keys(this.files).length)return void this.close("submit");const e=new FormData;for(const i in this.files)this.files.hasOwnProperty(i)&&this.files[i]instanceof File&&e.append(i,this.files[i],this.files[i].name);e.append("itemId",String(t)),this.dataService.postFormData(e).pipe(Object(r.a)(this.destroyed$)).subscribe({next:()=>{this.close("submit")},error:t=>{this.errorMessage=t.error||this.getLangString("ERROR"),this.submitted=!1,this.loading=!1}})}onSubmit(t=!1){if(this.formGroupMarkTouched(this.form),!this.form.valid)return this.errorMessage=this.getLangString("PLEASE_FIX_FORM_ERRORS"),void this.focusFormError();this.errorMessage="",this.loading=!0,this.submitted=!0;const e=this.getFormData();this.getSaveRequest(e).pipe(Object(r.a)(this.destroyed$)).subscribe({next:e=>{Object.keys(this.files).length>0?this.saveFiles(e._id||e.id):t&&this.close("submit"),e&&e.id&&(this.model.id=e.id),this.closeReason="updated",this.loading=!1,this.submitted=!1},error:t=>{t.error&&(this.errorMessage=t.error),t.errors&&(this.formErrors=t.errors,this.errorMessage=this.getLangString("PLEASE_FIX_FORM_ERRORS")),this.loading=!1,this.submitted=!1}})}onLocaleSwitch(){if(this.localeCurrent===this.localeDefault)return this.localeFieldsAllowed.forEach(t=>{this.model[t]=this.localePreviousValues[t],this.getControl(this.form,null,t).setValue(this.localePreviousValues[t])}),void(this.isSaveButtonDisabled=!1);this.model.translations||(this.model.translations={}),this.isSaveButtonDisabled=!0,this.localeFieldsAllowed.forEach(t=>{this.localePreviousValues[t]=this.getControl(this.form,null,t).value,this.model.translations[t]?(this.model[t]=this.model.translations[t][this.localeCurrent]||"",this.getControl(this.form,null,t).setValue(this.model[t])):(this.model[t]="",this.getControl(this.form,null,t).setValue(""))})}saveTranslations(t){t&&t.preventDefault(),this.localeFieldsAllowed.forEach(t=>{this.getControl(this.form,null,t)&&this.getControl(this.form,null,t).value?(this.model.translations[t]||(this.model.translations[t]={}),this.model.translations[t][this.localeCurrent]=this.getControl(this.form,null,t).value):this.model.translations[t]&&(this.model.translations[t][this.localeCurrent]&&delete this.model.translations[t][this.localeCurrent],0===Object.keys(this.model.translations[t]).length&&delete this.model.translations[t])}),this.localeCurrent=this.localeDefault,this.onLocaleSwitch()}emailValidator(t){return t.value?/\S+@\S+\.\S+/.test(t.value)?void 0:{email:!0}:{required:!0}}getRootElement(){return this.elRef.nativeElement.parentNode.parentNode.parentNode}createUniqueId(){return Math.random().toString(36).substr(2,9)}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}}return t.\u0275fac=function(e){return new(e||t)(c.Qb(n.e),c.Qb(a.b),c.Qb(l.d),c.Qb(s.a),c.Qb(c.l))},t.\u0275dir=c.Lb({type:t,viewQuery:function(t,e){var i;1&t&&c.Sc(d,!0),2&t&&c.Cc(i=c.jc())&&(e.formEl=i.first)},inputs:{modalTitle:"modalTitle",itemId:"itemId",modalId:"modalId",isItemCopy:"isItemCopy",isEditMode:"isEditMode"}}),t})()}}]);